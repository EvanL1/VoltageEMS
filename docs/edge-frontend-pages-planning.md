# VoltageEMS 边缘端前端页面规划方案

## 一、总体设计原则

1. **边缘端定位**：专注于本地设备管理和监控，不包含云端功能
2. **权限分级**：三级权限体系（操作员、工程师、管理员）
3. **功能聚焦**：每个页面专注于特定功能，避免功能堆砌
4. **实时响应**：优先展示实时数据和本地控制

## 二、用户权限体系

### 权限级别定义

| 角色 | 权限范围 | 功能说明 |
|------|----------|----------|
| 操作员(Operator) | 只读权限 | 查看实时数据、告警信息、设备状态 |
| 工程师(Engineer) | 读写权限 | 操作员权限 + 设备控制、告警处理、参数调整 |
| 管理员(Admin) | 完全权限 | 工程师权限 + 系统配置、用户管理、高级设置 |

## 三、页面层级规划（共20页）

### 1. 监控展示类（6页）- 所有用户可访问

#### 1.1 系统总览 Dashboard `/dashboard` 
**主页面** | 权限：所有用户

- **功能定位**：本地系统运行状态一览
- **核心组件**：
  - 关键指标卡片（设备总数、在线率、今日能耗、活跃告警）
  - 实时功率曲线（最近24小时）
  - 告警级别分布饼图
  - 设备状态统计
  - 快捷导航面板（根据权限显示）
- **权限控制**：操作按钮根据用户权限显示/隐藏

#### 1.2 实时监控 Real-time `/monitoring/realtime`
**子页面** | 权限：所有用户

- **功能定位**：实时数据监控
- **核心组件**：
  - 设备树导航
  - 实时数据表格（YC遥测数据）
  - 实时趋势图（多测点对比）
  - 数据刷新控制
- **权限控制**：
  - 操作员：只能查看
  - 工程师/管理员：可进行远程控制

#### 1.3 设备状态 Device Status `/monitoring/devices`
**子页面** | 权限：所有用户

- **功能定位**：设备运行状态监控
- **核心组件**：
  - 设备列表（在线/离线状态）
  - 通信质量指示
  - 最后通信时间
  - 设备详情快速查看
- **数据来源**：comsrv通信状态

#### 1.4 能耗统计 Energy Stats `/monitoring/energy`
**子页面** | 权限：所有用户

- **功能定位**：本地能耗数据展示
- **核心组件**：
  - 今日/本月/本年能耗
  - 分时能耗曲线
  - 设备能耗排名
  - 能效指标展示

#### 1.5 告警总览 Alarm Overview `/monitoring/alarms`
**子页面** | 权限：所有用户

- **功能定位**：告警信息展示
- **核心组件**：
  - 告警统计卡片
  - 活跃告警列表
  - 告警趋势图
  - 告警分类统计
- **权限控制**：操作员只能查看，不能确认

#### 1.6 系统拓扑 Topology `/monitoring/topology`
**子页面** | 权限：所有用户

- **功能定位**：系统架构可视化
- **核心组件**：
  - 设备连接拓扑图
  - 数据流向展示
  - 设备状态标识
  - 通信链路状态

### 2. 控制操作类（4页）- 工程师及以上权限

#### 2.1 设备控制 Device Control `/control/devices`
**主页面** | 权限：工程师、管理员

- **功能定位**：设备远程控制
- **核心组件**：
  - 可控设备列表
  - 遥控(YK)操作面板
  - 遥调(YT)参数设置
  - 控制日志记录
- **安全机制**：操作二次确认、权限校验

#### 2.2 告警处理 Alarm Management `/control/alarms`
**子页面** | 权限：工程师、管理员

- **功能定位**：告警确认和处理
- **核心组件**：
  - 待处理告警队列
  - 告警确认/清除
  - 处理记录填写
  - 告警抑制设置

#### 2.3 批量操作 Batch Control `/control/batch`
**子页面** | 权限：工程师、管理员

- **功能定位**：批量设备控制
- **核心组件**：
  - 设备组选择
  - 批量控制模板
  - 执行进度监控
  - 操作结果统计

#### 2.4 计划任务 Scheduled Tasks `/control/schedule`
**子页面** | 权限：工程师、管理员

- **功能定位**：定时控制任务
- **核心组件**：
  - 任务列表管理
  - 定时规则设置
  - 执行历史查询
  - 任务启停控制

### 3. 配置管理类（6页）- 管理员权限

#### 3.1 通道配置 Channel Config `/config/channels`
**主页面** | 权限：管理员

- **功能定位**：通信通道管理
- **核心组件**：
  - 通道列表（Modbus/CAN/IEC60870）
  - 协议参数配置
  - 连接测试工具
  - 通道启停控制
- **对应服务**：comsrv配置

#### 3.2 点表管理 Point Table `/config/points`
**子页面** | 权限：管理员

- **功能定位**：四遥点表配置
- **核心组件**：
  - 点表编辑器
  - CSV导入/导出
  - 映射关系配置
  - 数据类型设置（YC/YX/YK/YT）

#### 3.3 模型配置 Model Config `/config/models`
**子页面** | 权限：管理员

- **功能定位**：计算模型配置
- **核心组件**：
  - DAG工作流编辑器
  - 算法参数设置
  - 模型测试工具
  - 版本管理
- **对应服务**：modsrv配置

#### 3.4 告警规则 Alarm Rules `/config/alarms`
**子页面** | 权限：管理员

- **功能定位**：告警规则配置
- **核心组件**：
  - 规则列表管理
  - 条件表达式编辑
  - 告警级别设置
  - 通知方式配置

#### 3.5 存储策略 Storage Policy `/config/storage`
**子页面** | 权限：管理员

- **功能定位**：数据存储配置
- **核心组件**：
  - 数据保留期设置
  - 采样频率配置
  - 存储空间管理
  - 数据清理策略
- **对应服务**：hissrv配置

#### 3.6 网络转发 Network Forward `/config/network`
**子页面** | 权限：管理员

- **功能定位**：数据转发配置
- **核心组件**：
  - 转发目标设置
  - 数据过滤规则
  - 传输协议选择
  - 离线缓存配置
- **对应服务**：netsrv配置

### 4. 系统管理类（4页）- 管理员为主

#### 4.1 用户管理 User Management `/system/users`
**主页面** | 权限：管理员

- **功能定位**：用户和权限管理
- **核心组件**：
  - 用户列表（CRUD）
  - 角色分配
  - 权限矩阵展示
  - 登录日志查询

#### 4.2 系统设置 System Settings `/system/settings`
**子页面** | 权限：管理员

- **功能定位**：系统参数设置
- **核心组件**：
  - 基础信息配置
  - 时间同步设置
  - 系统限制参数
  - 许可证管理

#### 4.3 日志审计 Audit Logs `/system/audit`
**子页面** | 权限：管理员（工程师可查看部分）

- **功能定位**：操作审计
- **核心组件**：
  - 操作日志查询
  - 日志分类筛选
  - 关键操作追踪
  - 日志导出功能
- **权限控制**：
  - 工程师：只能查看自己的操作日志
  - 管理员：查看所有日志

#### 4.4 服务监控 Service Monitor `/system/services`
**子页面** | 权限：管理员（工程师可查看）

- **功能定位**：微服务状态监控
- **核心组件**：
  - 服务健康状态
  - CPU/内存使用率
  - 服务日志查看
  - 服务重启控制（仅管理员）
- **监控服务**：comsrv, modsrv, hissrv, netsrv, alarmsrv

## 四、权限控制实现方案

### 1. 菜单级权限
```javascript
// 路由配置示例
{
  path: '/config',
  meta: { 
    requiresAuth: true, 
    roles: ['admin'] 
  },
  children: [...]
}
```

### 2. 按钮级权限
```vue
<el-button 
  v-if="hasPermission('device.control')"
  @click="controlDevice">
  设备控制
</el-button>
```

### 3. API级权限
- 所有API请求携带JWT Token
- 后端验证用户角色和权限
- 返回403状态码表示无权限

## 五、页面交互流程

### 1. 登录流程
```
用户登录 → 获取Token和角色 → 动态生成菜单 → 进入首页
```

### 2. 权限验证流程
```
页面访问 → 路由守卫验证 → 组件权限检查 → API权限校验
```

### 3. 数据流程
```
实时数据：Redis → WebSocket → 前端展示
历史数据：InfluxDB → API → 前端展示
控制指令：前端 → API → Redis → 设备
```

## 六、开发优先级

### 第一阶段（核心功能）
1. 系统总览（所有用户）
2. 用户管理（管理员）
3. 实时监控（所有用户）
4. 设备控制（工程师）
5. 告警总览（所有用户）

### 第二阶段（扩展功能）
6. 通道配置（管理员）
7. 点表管理（管理员）
8. 告警处理（工程师）
9. 设备状态（所有用户）
10. 系统设置（管理员）

### 第三阶段（高级功能）
11. 模型配置（管理员）
12. 告警规则（管理员）
13. 批量操作（工程师）
14. 能耗统计（所有用户）
15. 日志审计（管理员）

### 第四阶段（完善功能）
16. 存储策略（管理员）
17. 网络转发（管理员）
18. 计划任务（工程师）
19. 系统拓扑（所有用户）
20. 服务监控（管理员）

## 七、技术实现要点

### 1. 前端架构
- Vue 3 + TypeScript
- Pinia状态管理（包含用户权限状态）
- Vue Router（路由权限控制）
- Element Plus（UI组件）

### 2. 权限中间件
```typescript
// 权限检查中间件
export const checkPermission = (permission: string) => {
  const user = useUserStore();
  return user.permissions.includes(permission);
}
```

### 3. 动态路由
```typescript
// 根据角色动态添加路由
const addDynamicRoutes = (role: string) => {
  const routes = getRoutesByRole(role);
  routes.forEach(route => {
    router.addRoute(route);
  });
}
```

## 八、安全考虑

1. **身份认证**：JWT Token + 刷新机制
2. **权限校验**：前后端双重验证
3. **操作审计**：所有关键操作记录日志
4. **数据加密**：敏感数据传输加密
5. **会话管理**：超时自动登出

## 九、总结

本方案针对VoltageEMS边缘端设计，去除了所有云端相关功能，专注于本地设备管理和监控。通过三级权限体系，确保不同角色用户只能访问和操作其权限范围内的功能，既保证了系统安全性，又提供了良好的用户体验。