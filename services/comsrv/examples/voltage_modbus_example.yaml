# Voltage Modbus TCP Client Configuration Example
# 这个配置文件展示了如何配置增强的Voltage Modbus TCP客户端
# 包含连接重试、心跳检测和数据映射等功能

channels:
  - id: 1
    name: "voltage_modbus_primary"
    description: "Primary Voltage Modbus TCP connection with full features"
    protocol: "ModbusTcp"
    parameters:
      # 基本连接参数
      host: "192.168.1.100"
      port: 502
      timeout_ms: 5000
      slave_id: 1
      
      # 连接重试配置
      max_retries: 3
      initial_delay_ms: 1000
      max_delay_ms: 30000
      backoff_multiplier: 2.0
      
      # 心跳检测配置
      heartbeat_enabled: true
      heartbeat_interval_seconds: 30
      heartbeat_timeout_ms: 5000
      heartbeat_test_address: 0
      heartbeat_test_count: 1
    
    # 数据点映射配置
    point_mappings:
      - name: "voltage_l1"
        display_name: "L1 Voltage"
        register_type: "holding_register"
        address: 1000
        data_type: "float32"
        scale: 0.1
        offset: 0.0
        unit: "V"
        description: "L1 phase voltage reading"
        access_mode: "read"
        group: "electrical"
        byte_order: "big_endian"
      
      - name: "voltage_l2"
        display_name: "L2 Voltage"
        register_type: "holding_register"
        address: 1002
        data_type: "float32"
        scale: 0.1
        offset: 0.0
        unit: "V"
        description: "L2 phase voltage reading"
        access_mode: "read"
        group: "electrical"
        byte_order: "big_endian"
      
      - name: "voltage_l3"
        display_name: "L3 Voltage"
        register_type: "holding_register"
        address: 1004
        data_type: "float32"
        scale: 0.1
        offset: 0.0
        unit: "V"
        description: "L3 phase voltage reading"
        access_mode: "read"
        group: "electrical"
        byte_order: "big_endian"
      
      - name: "current_l1"
        display_name: "L1 Current"
        register_type: "holding_register"
        address: 2000
        data_type: "float32"
        scale: 0.001
        offset: 0.0
        unit: "A"
        description: "L1 phase current reading"
        access_mode: "read"
        group: "electrical"
        byte_order: "big_endian"
      
      - name: "power_active"
        display_name: "Active Power"
        register_type: "holding_register"
        address: 3000
        data_type: "uint32"
        scale: 0.1
        offset: 0.0
        unit: "kW"
        description: "Total active power"
        access_mode: "read"
        group: "power"
        byte_order: "big_endian"
      
      - name: "power_reactive"
        display_name: "Reactive Power"
        register_type: "holding_register"
        address: 3002
        data_type: "int32"
        scale: 0.1
        offset: 0.0
        unit: "kVAR"
        description: "Total reactive power"
        access_mode: "read"
        group: "power"
        byte_order: "big_endian"
      
      - name: "frequency"
        display_name: "System Frequency"
        register_type: "holding_register"
        address: 4000
        data_type: "uint16"
        scale: 0.01
        offset: 0.0
        unit: "Hz"
        description: "System frequency"
        access_mode: "read"
        group: "electrical"
        byte_order: "big_endian"
      
      - name: "temperature"
        display_name: "Device Temperature"
        register_type: "input_register"
        address: 5000
        data_type: "int16"
        scale: 0.1
        offset: -40.0
        unit: "°C"
        description: "Internal device temperature"
        access_mode: "read"
        group: "environmental"
        byte_order: "big_endian"
      
      - name: "relay_status"
        display_name: "Relay Status"
        register_type: "coil"
        address: 0
        data_type: "bool"
        scale: 1.0
        offset: 0.0
        unit: ""
        description: "Main relay status"
        access_mode: "read_write"
        group: "controls"
        byte_order: "big_endian"
      
      - name: "alarm_status"
        display_name: "Alarm Status"
        register_type: "discrete_input"
        address: 100
        data_type: "bool"
        scale: 1.0
        offset: 0.0
        unit: ""
        description: "System alarm status"
        access_mode: "read"
        group: "status"
        byte_order: "big_endian"

  - id: 2
    name: "voltage_modbus_backup"
    description: "Backup Voltage Modbus TCP connection with minimal retry"
    protocol: "ModbusTcp"
    parameters:
      # 基本连接参数
      host: "192.168.1.101"
      port: 502
      timeout_ms: 3000
      slave_id: 1
      
      # 简化重试配置
      max_retries: 1
      initial_delay_ms: 500
      max_delay_ms: 5000
      backoff_multiplier: 1.5
      
      # 禁用心跳检测
      heartbeat_enabled: false
    
    # 仅包含关键数据点
    point_mappings:
      - name: "backup_voltage"
        display_name: "Backup Voltage"
        register_type: "holding_register"
        address: 1000
        data_type: "float32"
        scale: 0.1
        offset: 0.0
        unit: "V"
        description: "Backup voltage reading"
        access_mode: "read"
        group: "electrical"
        byte_order: "big_endian"
      
      - name: "backup_status"
        display_name: "Backup Status"
        register_type: "coil"
        address: 0
        data_type: "bool"
        scale: 1.0
        offset: 0.0
        unit: ""
        description: "Backup system status"
        access_mode: "read"
        group: "status"
        byte_order: "big_endian"

# 全局配置
global:
  # 日志级别
  log_level: "info"
  
  # 数据收集间隔（秒）
  collection_interval: 10
  
  # 连接池设置
  connection_pool:
    max_connections: 10
    idle_timeout_seconds: 300
  
  # 统计信息
  statistics:
    enabled: true
    interval_seconds: 60
    
  # 性能监控
  performance:
    enabled: true
    metrics_port: 9090 