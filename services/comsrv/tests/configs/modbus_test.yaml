# Modbus协议测试配置

protocol: modbus_tcp
name: "Modbus TCP Test Configuration"

# 连接参数
connection:
  host: "127.0.0.1"
  port: 5502
  timeout: 5000  # 毫秒
  retry_count: 3
  retry_delay: 1000  # 毫秒

# 设备配置
devices:
  - unit_id: 1
    name: "Test Device 1"
    points:
      # 线圈 (0x)
      - address: 0
        type: coil
        name: "Test Coil 0"
        expected_value: true
      
      - address: 1
        type: coil
        name: "Test Coil 1"
        expected_value: false
      
      # 离散输入 (1x)
      - address: 0
        type: discrete_input
        name: "Test DI 0"
        expected_value: true
      
      # 保持寄存器 (4x)
      - address: 0
        type: holding_register
        name: "Test HR 0"
        expected_value: 100
        data_type: uint16
      
      - address: 1
        type: holding_register
        name: "Test HR 1"
        expected_value: 200
        data_type: uint16
      
      # 输入寄存器 (3x)
      - address: 0
        type: input_register
        name: "Test IR 0"
        expected_value: 1000
        data_type: uint16

# 测试场景
test_scenarios:
  - name: "Basic Read Test"
    description: "Test basic read operations"
    operations:
      - type: read_coils
        address: 0
        quantity: 10
        expected_success: true
      
      - type: read_holding_registers
        address: 0
        quantity: 10
        expected_success: true
  
  - name: "Write Test"
    description: "Test write operations"
    operations:
      - type: write_single_coil
        address: 10
        value: true
        expected_success: true
      
      - type: write_single_register
        address: 10
        value: 1234
        expected_success: true
      
      - type: write_multiple_registers
        address: 20
        values: [100, 200, 300, 400]
        expected_success: true
  
  - name: "Error Handling Test"
    description: "Test error conditions"
    operations:
      - type: read_coils
        address: 65535  # Invalid address
        quantity: 10
        expected_success: false
        expected_error: "IllegalDataAddress"
      
      - type: read_holding_registers
        address: 0
        quantity: 200  # Too many registers
        expected_success: false
        expected_error: "IllegalDataValue"
  
  - name: "Performance Test"
    description: "Test performance metrics"
    operations:
      - type: read_holding_registers
        address: 0
        quantity: 100
        repeat: 1000
        max_latency_ms: 50
        min_throughput_ops_per_sec: 100

# 验证规则
validations:
  - name: "Connection Stability"
    description: "Verify connection remains stable"
    duration: 60  # 秒
    max_disconnections: 0
    max_errors_percent: 1.0
  
  - name: "Data Consistency"
    description: "Verify data consistency"
    check_interval: 1000  # 毫秒
    points_to_monitor:
      - "Test HR 0"
      - "Test HR 1"
    
  - name: "Response Time"
    description: "Verify response times"
    max_average_latency_ms: 20
    max_p95_latency_ms: 50
    max_p99_latency_ms: 100