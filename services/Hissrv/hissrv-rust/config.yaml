# Hissrv Configuration

# Redis configuration
redis:
  hostname: "localhost"
  port: 6379
  password: null  # Set to null if no password is required
  database: 0
  connection_timeout: 5  # Seconds
  key_pattern: "*"  # Redis key pattern to match
  polling_interval: 10  # Seconds

# InfluxDB configuration
influxdb:
  url: "http://localhost:8086"
  org: "voltage"
  token: "your-auth-token"  # Replace with your InfluxDB authentication token
  bucket: "history"
  batch_size: 1000
  flush_interval: 30  # Seconds

# Logging configuration
logging:
  level: "info"  # Possible values: debug, info, warn, error
  file: null  # Set to null for console logging, or provide file path

# Data mapping configuration
data_mapping:
  default_measurement: "ems_data"
  
  # Tag mappings define how Redis keys/values are mapped to InfluxDB tags
  tag_mappings:
    - redis_source: "device"
      influx_tag: "device_id"
      extract_from_key: true
      extraction_pattern: "device:(.*):data"
    
    - redis_source: "location"
      influx_tag: "location"
      extract_from_key: false
      extraction_pattern: null
  
  # Field mappings define how Redis values are mapped to InfluxDB fields
  field_mappings:
    - redis_source: "temperature"
      influx_field: "temperature"
      data_type: "float"
      scale_factor: 1.0
      measurement: "environmental"
    
    - redis_source: "humidity"
      influx_field: "humidity"
      data_type: "float"
      scale_factor: 1.0
      measurement: "environmental"
    
    - redis_source: "power"
      influx_field: "power_kw"
      data_type: "float"
      scale_factor: 0.001  # Convert from W to kW
      measurement: "energy"
    
    - redis_source: "energy"
      influx_field: "energy_kwh"
      data_type: "float"
      scale_factor: 0.001  # Convert from Wh to kWh
      measurement: "energy"
    
    - redis_source: "status"
      influx_field: "status"
      data_type: "string"
      scale_factor: 1.0
      measurement: "device_status"
    
    - redis_source: "error"
      influx_field: "has_error"
      data_type: "boolean"
      scale_factor: 1.0
      measurement: "device_status" 