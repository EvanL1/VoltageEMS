# Alarm Service Configuration

# Redis Configuration
redis:
  # Connection type: "Tcp" or "Unix"
  connection_type: "Tcp"
  # Redis host (for TCP connections)
  host: "localhost"
  # Redis port (for TCP connections)
  port: 6379
  # Unix socket path (for Unix socket connections)
  # socket_path: "/var/run/redis/redis.sock"
  # Redis password (optional)
  # password: "your_password"
  # Database number (default: 0)
  database: 0

# Alternative Unix Socket Configuration:
# redis:
#   connection_type: "Unix"
#   socket_path: "/var/run/redis/redis.sock"
#   database: 0
#   # password: "your_password"  # if needed

# API Configuration
api:
  host: "0.0.0.0"
  port: 8087

# Storage Configuration
storage:
  # Retention period for resolved alarms (in days)
  retention_days: 30
  # Enable automatic cleanup
  auto_cleanup: true
  # Cleanup interval (in hours)
  cleanup_interval_hours: 24

# Monitoring Configuration
monitoring:
  # Enable data scanning
  enabled: true
  # Channels to monitor (empty = all channels)
  channels: [1001, 1002, 1003]
  # Point types to monitor
  point_types: ["m", "s"]
  # Scan interval in seconds
  scan_interval: 10

# Alarm Rules
alarm_rules:
  # Temperature threshold alarm
  - id: "temp_high"
    name: "Temperature High Limit"
    description: "Monitor temperature upper limits"
    channel_id: 1001
    point_type: "m"
    point_id: 10001  # null = all points of this type
    rule_type:
      type: "Threshold"
      high: 80.0
      low: 20.0
      high_high: 95.0
      low_low: 10.0
    enabled: true
    alarm_title: "Temperature {threshold_type} Alert - Channel {channel_id} Point {point_id}"
    alarm_description: "Temperature value {value}°C exceeds {threshold_type} limit of {threshold_value}°C"

  # Pressure threshold alarm
  - id: "pressure_high"
    name: "Pressure High Limit"
    description: "Monitor pressure upper limits"
    channel_id: 1001
    point_type: "m"
    point_id: 10002
    rule_type:
      type: "Threshold"
      high: 10.0
      high_high: 12.0
    enabled: true
    alarm_title: "Pressure {threshold_type} Alert - Channel {channel_id} Point {point_id}"
    alarm_description: "Pressure value {value} MPa exceeds {threshold_type} limit of {threshold_value} MPa"

  # Communication timeout alarm for all measurement points
  - id: "comm_timeout_measurements"
    name: "Measurement Points Communication Timeout"
    description: "Monitor all measurement points for communication timeout"
    channel_id: 1001
    point_type: "m"
    # point_id: null means monitor all points of this type
    rule_type:
      type: "Timeout"
      warning_timeout: 60
      major_timeout: 300
      critical_timeout: 600
    enabled: true
    alarm_title: "Communication Timeout - Channel {channel_id} Point {point_id}"
    alarm_description: "No data received for {elapsed} seconds (timeout: {timeout}). Last update: {last_update}"

  # Signal state alarm
  - id: "breaker_open"
    name: "Circuit Breaker Open"
    description: "Alert when circuit breaker is open"
    channel_id: 1001
    point_type: "s"
    point_id: 20001
    rule_type:
      type: "Threshold"
      high: 0.5  # Signal value > 0.5 means breaker is open
    enabled: true
    alarm_title: "Circuit Breaker Open - Channel {channel_id} Point {point_id}"
    alarm_description: "Circuit breaker is in open state (value: {value})" 