# Monarch Hub 权限架构与角色功能分工

## 一、系统总体架构

### 1.1 系统定位
Monarch Hub 是一个工业物联网能源管理系统(IoT EMS)，专注于工业设备的实时监控、数据采集、智能控制和能源优化管理。

### 1.2 核心功能模块
```
┌─────────────────────────────────────────────────────────────┐
│                      Monarch Hub 系统架构                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │   监控中心    │  │   控制中心    │  │   分析中心    │     │
│  │              │  │              │  │              │     │
│  │ • 实时监控    │  │ • 设备控制    │  │ • 数据分析    │     │
│  │ • 告警管理    │  │ • 批量操作    │  │ • 趋势预测    │     │
│  │ • 地图展示    │  │ • 策略执行    │  │ • 报表生成    │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │   配置中心    │  │   系统管理    │  │   运维中心    │     │
│  │              │  │              │  │              │     │
│  │ • 通道配置    │  │ • 用户管理    │  │ • 日志审计    │     │
│  │ • 点表管理    │  │ • 权限设置    │  │ • 系统维护    │     │
│  │ • 模型配置    │  │ • 系统设置    │  │ • 备份恢复    │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 二、角色体系设计

### 2.1 角色层级
```
超级管理员 (Super Admin)
    ├── 系统管理员 (System Admin)
    │   ├── 运维工程师 (Operations Engineer)
    │   │   ├── 监控人员 (Monitor)
    │   │   └── 访客 (Guest)
```

### 2.2 角色定义与职责

#### 1. 超级管理员 (super_admin)
**定位**: 系统最高权限管理者，通常为系统部署方或核心技术人员
**核心职责**:
- 系统初始化配置与架构调整
- 核心安全策略制定
- 系统授权与许可管理
- 紧急情况下的系统恢复

#### 2. 系统管理员 (system_admin)
**定位**: 日常系统运维管理者，负责系统正常运行
**核心职责**:
- 用户账号与权限管理
- 系统参数配置
- 日常维护与监控
- 安全审计与合规

#### 3. 运维工程师 (ops_engineer)
**定位**: 设备运维专业人员，负责设备管理与优化
**核心职责**:
- 设备配置与调试
- 实时监控与控制
- 故障诊断与处理
- 运行优化建议

#### 4. 监控人员 (monitor)
**定位**: 值班监控人员，负责日常监视
**核心职责**:
- 实时数据监控
- 告警响应与上报
- 运行日志记录
- 基础数据查询

#### 5. 访客 (guest)
**定位**: 临时访问者或外部审计人员
**核心职责**:
- 查看公开数据
- 浏览系统概况
- 生成基础报表

## 三、功能权限矩阵

### 3.1 监控功能权限
| 功能模块 | 具体功能 | 超级管理员 | 系统管理员 | 运维工程师 | 监控人员 | 访客 |
|---------|---------|-----------|-----------|-----------|---------|------|
| **实时监控** | 查看实时数据 | ✓ | ✓ | ✓ | ✓ | ✓ |
| | 查看历史趋势 | ✓ | ✓ | ✓ | ✓ | ✓ |
| | 导出监控数据 | ✓ | ✓ | ✓ | ✓ | - |
| | 自定义监控面板 | ✓ | ✓ | ✓ | - | - |
| **Grafana集成** | 查看仪表板 | ✓ | ✓ | ✓ | ✓ | ✓ |
| | 编辑仪表板 | ✓ | ✓ | ✓ | - | - |
| | 创建仪表板 | ✓ | ✓ | - | - | - |
| **告警管理** | 查看告警 | ✓ | ✓ | ✓ | ✓ | - |
| | 确认告警 | ✓ | ✓ | ✓ | ✓ | - |
| | 处理告警 | ✓ | ✓ | ✓ | - | - |
| | 配置告警规则 | ✓ | ✓ | - | - | - |

### 3.2 控制功能权限
| 功能模块 | 具体功能 | 超级管理员 | 系统管理员 | 运维工程师 | 监控人员 | 访客 |
|---------|---------|-----------|-----------|-----------|---------|------|
| **设备控制** | 查看控制点状态 | ✓ | ✓ | ✓ | ✓ | - |
| | 单点控制 | ✓ | ✓ | ✓ | - | - |
| | 批量控制 | ✓ | ✓ | ✓ | - | - |
| | 紧急停机 | ✓ | ✓ | ✓ | - | - |
| **控制策略** | 查看策略 | ✓ | ✓ | ✓ | - | - |
| | 执行策略 | ✓ | ✓ | ✓ | - | - |
| | 编辑策略 | ✓ | ✓ | - | - | - |
| | 创建策略 | ✓ | ✓ | - | - | - |

### 3.3 配置功能权限
| 功能模块 | 具体功能 | 超级管理员 | 系统管理员 | 运维工程师 | 监控人员 | 访客 |
|---------|---------|-----------|-----------|-----------|---------|------|
| **通道配置** | 查看通道配置 | ✓ | ✓ | ✓ | - | - |
| | 修改通道参数 | ✓ | ✓ | ✓ | - | - |
| | 添加/删除通道 | ✓ | ✓ | - | - | - |
| **点表管理** | 查看点表 | ✓ | ✓ | ✓ | ✓ | - |
| | 修改点位信息 | ✓ | ✓ | ✓ | - | - |
| | 导入/导出点表 | ✓ | ✓ | ✓ | - | - |
| **模型配置** | 查看计算模型 | ✓ | ✓ | ✓ | - | - |
| | 修改模型参数 | ✓ | ✓ | - | - | - |
| | 创建/删除模型 | ✓ | ✓ | - | - | - |

### 3.4 系统管理权限
| 功能模块 | 具体功能 | 超级管理员 | 系统管理员 | 运维工程师 | 监控人员 | 访客 |
|---------|---------|-----------|-----------|-----------|---------|------|
| **用户管理** | 查看用户列表 | ✓ | ✓ | - | - | - |
| | 创建用户 | ✓ | ✓ | - | - | - |
| | 修改用户信息 | ✓ | ✓ | - | - | - |
| | 删除用户 | ✓ | ✓* | - | - | - |
| | 重置密码 | ✓ | ✓* | - | - | - |
| **系统设置** | 查看系统参数 | ✓ | ✓ | ✓ | - | - |
| | 修改系统参数 | ✓ | ✓ | - | - | - |
| | 系统维护模式 | ✓ | - | - | - | - |
| **审计日志** | 查看操作日志 | ✓ | ✓ | - | - | - |
| | 查看登录日志 | ✓ | ✓ | - | - | - |
| | 导出日志 | ✓ | ✓ | - | - | - |
| | 清理日志 | ✓ | - | - | - | - |

注：✓* 表示有限制条件（如系统管理员不能删除超级管理员）

## 四、典型使用场景

### 4.1 日常监控场景
**参与角色**: 监控人员
**工作流程**:
1. 登录系统查看实时监控大屏
2. 定期巡检各设备运行状态
3. 发现异常立即查看告警详情
4. 确认告警并通知相关人员
5. 记录处理过程

### 4.2 设备维护场景
**参与角色**: 运维工程师
**工作流程**:
1. 接收维护任务或告警通知
2. 查看设备详细运行数据
3. 分析故障原因
4. 执行远程控制操作
5. 验证维护效果
6. 更新维护记录

### 4.3 系统配置场景
**参与角色**: 系统管理员、运维工程师
**工作流程**:
1. 评估配置变更需求
2. 备份当前配置
3. 修改相关参数
4. 测试配置效果
5. 应用到生产环境
6. 监控运行状态

### 4.4 用户管理场景
**参与角色**: 系统管理员
**工作流程**:
1. 接收用户账号申请
2. 创建用户账号
3. 分配适当角色
4. 设置权限范围
5. 通知用户登录信息
6. 定期审查权限

### 4.5 应急响应场景
**参与角色**: 所有角色（按级别）
**工作流程**:
1. 系统自动触发紧急告警
2. 监控人员确认并上报
3. 运维工程师远程介入
4. 必要时执行紧急控制
5. 系统管理员协调资源
6. 超级管理员最终决策

## 五、安全设计原则

### 5.1 最小权限原则
- 每个角色仅拥有完成工作所需的最小权限集
- 权限不可向上越级
- 临时权限需要审批

### 5.2 职责分离原则
- 配置与审计分离
- 操作与审批分离
- 开发与运维分离

### 5.3 审计追踪原则
- 所有操作记录日志
- 关键操作需要确认
- 支持操作回溯

### 5.4 纵深防御原则
- 多层次权限验证
- 敏感操作二次确认
- 定期权限审查

## 六、实施建议

### 6.1 初始部署
1. 创建超级管理员账号
2. 配置系统基础参数
3. 创建组织架构
4. 分配管理员账号
5. 制定权限策略

### 6.2 日常运维
1. 定期审查用户权限
2. 及时清理离职账号
3. 监控异常访问行为
4. 更新权限策略
5. 培训用户安全意识

### 6.3 应急预案
1. 制定权限恢复流程
2. 准备应急账号
3. 定期演练恢复过程
4. 建立升级机制
5. 保持通讯畅通

## 七、扩展考虑

### 7.1 未来可扩展的角色
- **数据分析师**: 专注于数据挖掘和报表
- **外部审计员**: 临时的合规检查
- **设备厂商**: 远程技术支持
- **能源顾问**: 优化建议提供

### 7.2 集成考虑
- 支持LDAP/AD集成
- 单点登录(SSO)
- OAuth2.0认证
- 多因素认证(MFA)

### 7.3 合规要求
- 符合ISO27001信息安全标准
- 满足行业监管要求
- 支持审计追踪
- 数据隐私保护