version: "2.0"

service:
  name: "comsrv_complete"
  description: "Communication Service - Complete CSV Demo"
  
  api:
    enabled: true
    bind_address: "0.0.0.0:3000"
    version: "v2"
  
  redis:
    enabled: true
    url: "redis://127.0.0.1:6379/1"
    database: 1
    timeout_ms: 5000
    max_retries: 3
  
  logging:
    level: "info"
    console: true
    max_size: 104857600
    max_files: 5
    enable_channel_logging: true

channels:
  - id: 1001
    name: "ElectricMeter_ModbusTCP"
    description: "智能电表Modbus TCP通信"
    protocol: "modbus_tcp"
    parameters:
      host: "192.168.1.100"
      port: 502
      timeout_ms: 1000
      max_retries: 3
      polling_interval: 1000  # 1秒轮询间隔 - 通道级别配置
    
    logging:
      enabled: true
      level: "debug"
      log_messages: true
    
    table_config:
      four_telemetry_route: "config/ElectricMeter_ModbusTCP"
      four_telemetry_files:
        telemetry_file: "telemetry.csv"
        signal_file: "signal.csv"
        adjustment_file: "adjustment.csv"
        control_file: "control.csv"
      
      protocol_mapping_route: "config/ElectricMeter_ModbusTCP"
      protocol_mapping_files:
        telemetry_mapping: "mapping_telemetry.csv"
        signal_mapping: "mapping_signal.csv"
        adjustment_mapping: "mapping_adjustment.csv"
        control_mapping: "mapping_control.csv"

  - id: 1002
    name: "CANBus_BMS"
    description: "电池管理系统CAN总线通信"
    protocol: "can"
    parameters:
      interface: "can0"
      bitrate: 250000
      timeout_ms: 500
      polling_interval: 100  # 100ms轮询间隔 - CAN总线更快
    
    logging:
      enabled: true
      level: "info"
      log_messages: true
    
    table_config:
      four_telemetry_route: "config/CANBus_BMS"
      four_telemetry_files:
        telemetry_file: "telemetry.csv"
        signal_file: "signal.csv"
        adjustment_file: "adjustment.csv"
        control_file: "control.csv"
      
      protocol_mapping_route: "config/CANBus_BMS"
      protocol_mapping_files:
        telemetry_mapping: "mapping_telemetry.csv"
        signal_mapping: "mapping_signal.csv"
        adjustment_mapping: "mapping_adjustment.csv"
        control_mapping: "mapping_control.csv"

defaults:
  channels_root: "channels"
  combase_dir: "combase"
  protocol_dir: "protocol"