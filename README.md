# VoltageEMS - æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿ

VoltageEMS æ˜¯ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„å·¥ä¸šç‰©è”ç½‘èƒ½æºç®¡ç†ç³»ç»Ÿï¼Œä¸“ä¸ºç”µåŠ›ç›‘æ§ã€èƒ½æºä¼˜åŒ–å’Œè®¾å¤‡ç®¡ç†è€Œè®¾è®¡ã€‚ç³»ç»Ÿé‡‡ç”¨ Rust æ„å»ºæ ¸å¿ƒæœåŠ¡ï¼Œæä¾›é«˜æ€§èƒ½ã€å¯é çš„å®æ—¶æ•°æ®é‡‡é›†å’Œå¤„ç†èƒ½åŠ›ã€‚

## ç³»ç»Ÿç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**: åŸºäº Rust çš„å¼‚æ­¥æ¶æ„ï¼Œæ”¯æŒé«˜å¹¶å‘æ•°æ®å¤„ç†
- ğŸ”Œ **å¤šåè®®æ”¯æŒ**: Modbus TCP/RTUã€CANã€IEC60870ã€GPIO ç­‰å·¥ä¸šåè®®
- ğŸ“Š **å®æ—¶ç›‘æ§**: æ¯«ç§’çº§æ•°æ®é‡‡é›†å’Œå¤„ç†èƒ½åŠ›
- ğŸŒ **äº‘ç«¯é›†æˆ**: æ”¯æŒ AWS IoT Core å’Œé˜¿é‡Œäº‘ IoT å¹³å°
- ğŸ“ˆ **æ•°æ®åˆ†æ**: å†…ç½®æ—¶åºæ•°æ®åº“å’Œå¯è§†åŒ–å¹³å°
- ğŸ”” **æ™ºèƒ½å‘Šè­¦**: å¤šçº§å‘Šè­¦åˆ†ç±»å’Œè‡ªåŠ¨å¤„ç†æœºåˆ¶
- ğŸ›¡ï¸ **é«˜å¯é æ€§**: åˆ†å¸ƒå¼æ¶æ„ï¼Œæ”¯æŒæ•…éšœè½¬ç§»å’Œè‡ªåŠ¨æ¢å¤

## æ ¸å¿ƒæœåŠ¡

- **comsrv**: å·¥ä¸šé€šä¿¡æœåŠ¡ï¼Œæ”¯æŒå¤šç§å·¥ä¸šåè®®çš„æ•°æ®é‡‡é›†
- **apigateway**: API ç½‘å…³æœåŠ¡ï¼Œæä¾›ç»Ÿä¸€çš„ REST API æ¥å£
- **modsrv**: æ¨¡å‹è®¡ç®—æœåŠ¡ï¼Œæ‰§è¡Œå®æ—¶è®¡ç®—å’Œæ§åˆ¶é€»è¾‘
- **hissrv**: å†å²æ•°æ®æœåŠ¡ï¼Œè´Ÿè´£æ—¶åºæ•°æ®çš„å­˜å‚¨å’ŒæŸ¥è¯¢
- **netsrv**: ç½‘ç»œè½¬å‘æœåŠ¡ï¼Œæ”¯æŒ MQTT/HTTP åè®®çš„æ•°æ®åˆ†å‘
- **alarmsrv**: æ™ºèƒ½å‘Šè­¦æœåŠ¡ï¼Œæä¾›å‘Šè­¦åˆ†ç±»ã€å­˜å‚¨å’Œæ¨é€åŠŸèƒ½


## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å·¥ä¸šè®¾å¤‡       â”‚     â”‚   å‰ç«¯åº”ç”¨       â”‚     â”‚   ç¬¬ä¸‰æ–¹ç³»ç»Ÿ     â”‚
â”‚  Modbus/CAN/... â”‚     â”‚   Vue.js        â”‚     â”‚  AWS/é˜¿é‡Œäº‘     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                        â”‚
         â–¼                       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    comsrv       â”‚     â”‚   apigateway    â”‚     â”‚    netsrv       â”‚
â”‚  é€šä¿¡æœåŠ¡        â”‚â—„â”€â”€â”€â”€â”‚   APIç½‘å…³        â”‚â”€â”€â”€â”€â–ºâ”‚   ç½‘ç»œæœåŠ¡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                        â”‚
         â–¼                       â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        Redis                           â”‚
    â”‚                    å®æ—¶æ•°æ®æ€»çº¿                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                        â”‚
         â–¼                       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    modsrv       â”‚     â”‚    hissrv       â”‚     â”‚   alarmsrv      â”‚
â”‚   æ¨¡å‹æœåŠ¡       â”‚     â”‚   å†å²æœåŠ¡       â”‚     â”‚   å‘Šè­¦æœåŠ¡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   InfluxDB      â”‚
                        â”‚  æ—¶åºæ•°æ®åº“      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


## æŠ€æœ¯æ ˆ

### åç«¯æœåŠ¡
- **è¯­è¨€**: Rust 1.70+
- **æ¡†æ¶**: Actix Web (API Gateway), Tokio (å¼‚æ­¥è¿è¡Œæ—¶)
- **é€šä¿¡**: Redis (æ¶ˆæ¯æ€»çº¿), gRPC (æœåŠ¡é—´é€šä¿¡)
- **å­˜å‚¨**: Redis (å®æ—¶æ•°æ®), InfluxDB (æ—¶åºæ•°æ®)

### å‰ç«¯åº”ç”¨
- **æ¡†æ¶**: Vue.js 3 + Element Plus
- **å¯è§†åŒ–**: Grafana (åµŒå…¥å¼)
- **æ„å»ºå·¥å…·**: Vite

### åŸºç¡€è®¾æ–½
- **å®¹å™¨åŒ–**: Docker, Docker Compose
- **ç›‘æ§**: Prometheus + Grafana
- **æ—¥å¿—**: ç»“æ„åŒ–æ—¥å¿— (JSON)

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Rust 1.70+
- Redis 6.0+
- InfluxDB 2.0+ (å¯é€‰)
- Node.js 16+ (å‰ç«¯)
- Docker & Docker Compose (æ¨è)

### ä½¿ç”¨ Docker Compose å¯åŠ¨

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-org/VoltageEMS.git
cd VoltageEMS

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### æœ¬åœ°å¼€å‘å¯åŠ¨

1. **å¯åŠ¨ Redis**
```bash
docker run -d -p 6379:6379 redis:latest
```

2. **å¯åŠ¨åç«¯æœåŠ¡**
```bash
# æ„å»ºæ‰€æœ‰æœåŠ¡
cargo build --release

# å¯åŠ¨é€šä¿¡æœåŠ¡
cd services/comsrv
cargo run

# å¯åŠ¨ API ç½‘å…³ (æ–°ç»ˆç«¯)
cd services/apigateway
cargo run

# å¯åŠ¨å…¶ä»–æœåŠ¡...
```

3. **å¯åŠ¨å‰ç«¯**
```bash
cd frontend
npm install
npm run dev
```

### è®¿é—®åœ°å€

- **å‰ç«¯åº”ç”¨**: http://localhost:5173
- **API ç½‘å…³**: http://localhost:8080
- **Grafana**: http://localhost:3000 (admin/admin)
- **InfluxDB**: http://localhost:8086

## é…ç½®è¯´æ˜

æ¯ä¸ªæœåŠ¡éƒ½æœ‰ç‹¬ç«‹çš„ YAML é…ç½®æ–‡ä»¶ï¼š

### é€šä¿¡æœåŠ¡é…ç½® (comsrv.yaml)
```yaml
redis:
  url: "redis://127.0.0.1:6379"

channels:
  - id: 1
    name: "ç”µè¡¨é€šé“"
    protocol: modbus_tcp
    enabled: true
    parameters:
      modbus_tcp:
        host: "192.168.1.100"
        port: 502
        slave_id: 1
        timeout: 5000
```

### API ç½‘å…³é…ç½® (apigateway.yaml)
```yaml
server:
  host: "0.0.0.0"
  port: 8080

redis:
  url: "redis://127.0.0.1:6379"

services:
  comsrv_prefix: "/api/v1/comsrv"
  modsrv_prefix: "/api/v1/modsrv"
  # ...
```

### ç‚¹è¡¨é…ç½® (CSV æ ¼å¼)

ç³»ç»Ÿæ”¯æŒé€šè¿‡ CSV æ–‡ä»¶é…ç½®ç‚¹è¡¨ï¼š

**telemetry.csv** (é¥æµ‹ç‚¹)
```csv
point_id,name,address,data_type,scale,offset,unit
1,ç”µå‹Aç›¸,30001,float32,0.1,0,V
2,ç”µæµAç›¸,30003,float32,0.01,0,A
```

## API æ–‡æ¡£

API ç½‘å…³æä¾›ç»Ÿä¸€çš„ REST æ¥å£ï¼Œè¯¦ç»†æ–‡æ¡£è¯·å‚è€ƒ [API Gateway README](services/apigateway/README.md)

### ä¸»è¦æ¥å£

- `GET /api/v1/health` - å¥åº·æ£€æŸ¥
- `GET /api/v1/comsrv/channels` - è·å–é€šé“åˆ—è¡¨
- `GET /api/v1/comsrv/points/{device_id}` - è·å–è®¾å¤‡ç‚¹ä½
- `POST /api/v1/comsrv/command` - å‘é€æ§åˆ¶å‘½ä»¤
- `GET /api/v1/hissrv/query` - æŸ¥è¯¢å†å²æ•°æ®
- `GET /api/v1/alarmsrv/alarms` - è·å–å‘Šè­¦åˆ—è¡¨

## å¼€å‘æŒ‡å—

### åˆ†æ”¯ç®¡ç†

- `main` - ä¸»åˆ†æ”¯ï¼Œç¨³å®šç‰ˆæœ¬
- `develop` - å¼€å‘åˆ†æ”¯
- `feature/*` - åŠŸèƒ½åˆ†æ”¯
- `hotfix/*` - ç´§æ€¥ä¿®å¤åˆ†æ”¯

### ä»£ç è§„èŒƒ

```bash
# æ ¼å¼åŒ–ä»£ç 
cargo fmt

# ä»£ç æ£€æŸ¥
cargo clippy -- -D warnings

# è¿è¡Œæµ‹è¯•
cargo test
```

### æäº¤è§„èŒƒ

ä½¿ç”¨è¯­ä¹‰åŒ–æäº¤ä¿¡æ¯ï¼š
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤é—®é¢˜
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºæˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

## æ€§èƒ½ä¼˜åŒ–

- **å¼‚æ­¥å¤„ç†**: åŸºäº Tokio çš„å¼‚æ­¥ I/O
- **è¿æ¥æ± **: Redis å’Œæ•°æ®åº“è¿æ¥æ± 
- **æ‰¹é‡å¤„ç†**: æ•°æ®æ‰¹é‡å†™å…¥å’ŒæŸ¥è¯¢
- **ç¼“å­˜ç­–ç•¥**: å¤šçº§ç¼“å­˜æœºåˆ¶

## å®‰å…¨ç‰¹æ€§

- **è®¤è¯æˆæƒ**: JWT Token è®¤è¯
- **æ•°æ®åŠ å¯†**: TLS/SSL åŠ å¯†ä¼ è¾“
- **è®¿é—®æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•

## ç›‘æ§è¿ç»´

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
RUST_LOG=info cargo run

# è°ƒè¯•æ¨¡å¼
RUST_LOG=debug cargo run

# æŸ¥çœ‹ç‰¹å®šæ¨¡å—æ—¥å¿—
RUST_LOG=comsrv=debug cargo run
```

### æ€§èƒ½ç›‘æ§

- Prometheus æŒ‡æ ‡æ”¶é›†
- Grafana å¯è§†åŒ–ç›‘æ§
- å®æ—¶å‘Šè­¦é€šçŸ¥

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„å·¥ä¸šåè®®ï¼Ÿ

A: åœ¨ `comsrv/src/core/protocols/` ç›®å½•ä¸‹å®ç°æ–°çš„åè®®æ¨¡å—ï¼Œå¹¶æ³¨å†Œåˆ°åè®®å·¥å‚ä¸­ã€‚

### Q: å¦‚ä½•é…ç½®é«˜å¯ç”¨éƒ¨ç½²ï¼Ÿ

A: ä½¿ç”¨ Redis Sentinel æˆ– Cluster æ¨¡å¼ï¼Œé…åˆæœåŠ¡çš„å¤šå®ä¾‹éƒ¨ç½²å®ç°é«˜å¯ç”¨ã€‚

### Q: æ•°æ®å­˜å‚¨å®¹é‡è§„åˆ’ï¼Ÿ

A: InfluxDB å­˜å‚¨å®¹é‡ = ç‚¹ä½æ•° Ã— é‡‡æ ·é¢‘ç‡ Ã— æ•°æ®ä¿ç•™æ—¶é—´ Ã— å•ç‚¹æ•°æ®å¤§å°

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'feat: add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## æŠ€æœ¯æ”¯æŒ

- æ–‡æ¡£ï¼š[https://docs.voltageems.io](https://docs.voltageems.io)
- é—®é¢˜åé¦ˆï¼š[GitHub Issues](https://github.com/your-org/VoltageEMS/issues)
- é‚®ä»¶ï¼šsupport@voltageems.io

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)

## è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œå¼€æºç¤¾åŒºçš„æ”¯æŒï¼

---

**VoltageEMS** - è®©èƒ½æºç®¡ç†æ›´æ™ºèƒ½ã€æ›´é«˜æ•ˆ ğŸš€
